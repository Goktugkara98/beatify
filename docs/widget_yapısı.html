<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Widget - Detaylı Analiz Raporu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Koyu Gri Arka Plan */
            color: #d1d5db; /* Açık Gri Yazı */
        }
        .tab-button {
            transition: all 0.3s ease;
            border-bottom-width: 2px;
            border-color: transparent;
        }
        .tab-button.active {
            color: #34d399; /* Zümrüt Yeşili */
            border-color: #34d399;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        code {
            background-color: #1f2937; /* Daha Koyu Gri */
            color: #93c5fd; /* Açık Mavi */
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
        }
        pre {
            background-color: #1f2937;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #374151;
        }
        .pro { color: #34d399; }
        .con { color: #f87171; }
        .pro::before { content: '✓ '; }
        .con::before { content: '✗ '; }
        h3 {
            border-left: 3px solid #34d399;
            padding-left: 10px;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-white">Spotify Widget Proje Analizi</h1>
            <p class="mt-4 text-lg text-gray-400">Dosyaların derinlemesine incelenmesi, fonksiyonların ve yapıların değerlendirilmesi.</p>
        </header>

        <div class="bg-gray-800 rounded-xl shadow-2xl p-4 md:p-6">
            <!-- Genel Bakış -->
            <div class="mb-8 border-b border-gray-700 pb-6">
                <h2 class="text-2xl font-bold text-white mb-3">Genel Mimarî Bakış</h2>
                <p class="text-gray-300">
                    Bu proje, son derece modüler ve yeniden kullanılabilir bir yapıda tasarlanmıştır. İki ana katmandan oluşur:
                </p>
                <ul class="list-disc list-inside mt-4 space-y-2 text-gray-300">
                    <li><strong class="text-white">Çekirdek (Core) Katmanı:</strong> <code>spotify_widget_core.js</code> ve <code>spotify_widget_core.css</code> dosyalarından oluşur. Bu katman, API ile iletişimi, veri işlemeyi, durum yönetimini ve tüm widget'lar için ortak olan temel stil ve fonksiyonları sağlar. Tamamen arayüzden bağımsızdır.</li>
                    <li><strong class="text-white">Görünüm (View) Katmanı:</strong> <code>widget_modern.html</code>, <code>widget_modern.js</code>, <code>widget_modern.css</code> ve <code>widget_modern_animations.css</code> dosyalarından oluşur. Bu katman, Çekirdek'ten gelen veriyi alıp kullanıcıya sunmakla görevlidir. Widget'ın tüm görsel kimliği, animasyonları ve kullanıcı arayüzü mantığı bu katmanda yer alır.</li>
                </ul>
                <p class="mt-4 text-gray-300">
                    Bu mimari sayesinde, gelecekte farklı tasarımlara sahip yeni widget'lar oluşturmak, sadece yeni bir "Görünüm" katmanı yazarak mümkün olacaktır. Çekirdek mantığına dokunmaya gerek kalmaz. Bu, projenin en güçlü yönlerinden biridir.
                </p>
            </div>

            <!-- Sekmeler -->
            <div class="mb-6 border-b border-gray-700">
                <nav class="flex flex-wrap -mb-px space-x-4 text-lg">
                    <button class="tab-button active" data-target="html">HTML</button>
                    <button class="tab-button" data-target="core-js">Core JS</button>
                    <button class="tab-button" data-target="modern-js">Modern JS</button>
                    <button class="tab-button" data-target="core-css">Core CSS</button>
                    <button class="tab-button" data-target="modern-css">Modern CSS</button>
                    <button class="tab-button" data-target="anim-css">Animation CSS</button>
                </nav>
            </div>

            <!-- Sekme İçerikleri -->
            <div id="tab-contents">
                <!-- widget_modern.html -->
                <div id="html" class="tab-content active">
                    <h2 class="text-3xl font-bold text-white mb-4"><code>widget_modern.html</code></h2>
                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Genel Bakış</h3>
                    <p>Bu dosya, widget'ın iskeletini oluşturur. Gerekli CSS ve JS dosyalarını yükler ve widget'ı oluşturan tüm HTML elemanlarını içerir. En dikkat çekici özelliği, animasyonlar ve konfigürasyon için yoğun bir şekilde <code>data-*</code> attribute'larını kullanmasıdır. Bu "deklaratif" yaklaşım, JS kodunu daha temiz tutar.</p>

                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Element Analizi</h3>
                    <ul class="list-disc list-inside space-y-3">
                        <li><code>#spotifyWidgetModern</code>: Widget'ın ana konteyneridir. <code>data-token</code> ve <code>data-endpoint-template</code> ile JS için gerekli konfigürasyon bilgilerini barındırır.</li>
                        <li><code>A/B Setleri (id sonu "_a" ve "_b" olanlar)</code>: Projenin en zekice kısımlarından biri. Şarkı geçişlerinde akıcı animasyonlar sağlamak için iki set element kullanılır. Biri (aktif set) ekranda görünürken, diğeri (pasif set) gizli bir şekilde yeni şarkı bilgileriyle doldurulur ve animasyonla ekrana gelir. Bu, kesintisiz bir kullanıcı deneyimi sunar.</li>
                        <li><code>data-set="a|b"</code>: Bir elementin hangi sete ait olduğunu belirtir.</li>
                        <li><code>data-type="..."</code>: Bir elementin türünü (ör: <code>albumArt</code>, <code>trackName</code>) belirtir. Bu, JS'nin elementleri kolayca bulup güncellemesini sağlar.</li>
                        <li><code>data-transition-in-*</code>, <code>data-transition-out-*</code> vb.: Bir elementin farklı durumlarda (giriş, çıkış, geçiş) hangi animasyonu, ne kadar sürede ve ne kadar gecikmeyle alacağını tanımlar. Animasyon mantığını doğrudan HTML'de tanımlamak, esnekliği artırır.</li>
                    </ul>

                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Değerlendirme</h3>
                    <p class="pro"><strong>Olumlu Yönler:</strong></p>
                    <ul class="list-disc list-inside ml-4 space-y-2 text-gray-300">
                        <li><span class="pro">Deklaratif Yapı:</span> Animasyonların HTML içinde tanımlanması, JS kodunu basitleştirir ve okunabilirliği artırır.</li>
                        <li><span class="pro">A/B Geçiş Sistemi:</span> Akıcı ve profesyonel animasyonlar için mükemmel bir temel oluşturur.</li>
                        <li><span class="pro">Semantik ve Anlaşılır ID'ler:</span> <code>trackName_a</code>, <code>albumArt_b</code> gibi isimlendirmeler yapıyı anlamayı kolaylaştırır.</li>
                    </ul>
                    <p class="con mt-4"><strong>Geliştirme Önerileri:</strong></p>
                    <ul class="list-disc list-inside ml-4 space-y-2 text-gray-300">
                        <li><span class="con">Attribute Yoğunluğu:</span> Çok sayıda <code>data-*</code> attribute'u, HTML'i biraz kalabalık gösterebilir. Ancak bu, deklaratif yaklaşımın doğal bir sonucudur ve genellikle kabul edilebilir bir durumdur.</li>
                    </ul>
                </div>

                <!-- spotify_widget_core.js -->
                <div id="core-js" class="tab-content">
                    <h2 class="text-3xl font-bold text-white mb-4"><code>spotify_widget_core.js</code></h2>
                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Genel Bakış</h3>
                    <p>Projenin beyni. Bu dosya, widget'ın tüm arka plan mantığını yönetir. API'den veri çeker, veriyi işler, ne zaman güncelleme yapılacağına karar verir ve bu değişiklikleri "callback" fonksiyonları aracılığıyla arayüze (görünüm katmanına) bildirir. Bu dosya, farklı görünümlere sahip başka widget'lar için de hiç değiştirilmeden kullanılabilir.</p>

                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Fonksiyon Analizi</h3>
                    <ul class="list-disc list-inside space-y-3">
                        <li><code>initWidgetBase(config)</code>: Widget'ı başlatan ana fonksiyondur. Gerekli ayarları (token, endpoint, callback'ler) alır ve ilk veri çekme işlemini tetikler.</li>
                        <li><code>_fetchData()</code>: Sunucuya (API endpoint'ine) <code>fetch</code> isteği göndererek anlık şarkı verisini çeker. Hata kontrolü yapar.</li>
                        <li><code>_pollForData()</code>: Ana döngüdür. Belirli aralıklarla <code>_fetchData</code>'yı çağırır. Bu aralığı, şarkının çalıp çalmamasına veya bir hata olup olmamasına göre akıllıca ayarlar.</li>
                        <li><code>_determinePollInterval(...)</code>: Bir sonraki API isteğinin ne kadar süre sonra yapılacağını belirler. Şarkı çalmıyorsa daha uzun, hata varsa daha da uzun bekleyerek gereksiz sunucu yükünü önler.</li>
                        <li><code>_processNewData(newData)</code>: Gelen yeni veriyi bir önceki veriyle karşılaştırır. Eğer şarkı değişmişse <code>onSongChange</code> callback'ini, sadece ilerleme gibi küçük bir detay değişmişse <code>onDataUpdate</code> callback'ini tetikler.</li>
                        <li><code>updateProgressBar(...)</code>: İlerleme çubuğunun animasyonunu ve zaman göstergelerini yöneten bir yardımcı fonksiyondur.</li>
                        <li><code>activateWidget() / deactivateWidget()</code>: Widget'ın genel aktif/deaktif durumunu yönetir ve veri çekme döngüsünü (polling) başlatır/durdurur.</li>
                    </ul>

                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Değerlendirme</h3>
                    <p class="pro"><strong>Olumlu Yönler:</strong></p>
                    <ul class="list-disc list-inside ml-4 space-y-2 text-gray-300">
                        <li><span class="pro">Mükemmel Modülerlik:</span> Çekirdek mantığı, arayüzden tamamen soyutlanmıştır. Bu, kodun yeniden kullanılabilirliğini ve bakımını çok kolaylaştırır.</li>
                        <li><span class="pro">Verimli Polling:</span> Sorgulama aralığını dinamik olarak değiştirmesi, sistem kaynaklarını verimli kullanır.</li>
                        <li><span class="pro">Callback Tabanlı Mimari:</span> <code>onSongChange</code>, <code>onError</code> gibi callback'ler sayesinde, bu çekirdek modülü, onu kullanan arayüz koduna esnek bir şekilde bağlanabilir.</li>
                        <li><span class="pro">Detaylı Loglama:</span> Hata ayıklamayı kolaylaştıran iyi bir loglama sistemine sahiptir.</li>
                    </ul>
                     <p class="con mt-4"><strong>Geliştirme Önerileri:</strong></p>
                    <ul class="list-disc list-inside ml-4 space-y-2 text-gray-300">
                        <li><span class="con">Global Durum Yönetimi:</span> Durum değişkenleri (<code>currentTrackId</code>, <code>isPollingActive</code> vb.) modül seviyesinde `let` ile tanımlanmış. Daha karmaşık uygulamalarda, bu değişkenleri tek bir state objesi içinde toplamak, yönetimi daha da kolaylaştırabilir.</li>
                    </ul>
                </div>

                <!-- widget_modern.js -->
                <div id="modern-js" class="tab-content">
                    <h2 class="text-3xl font-bold text-white mb-4"><code>widget_modern.js</code></h2>
                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Genel Bakış</h3>
                    <p>Bu dosya, <code>WidgetCore</code> (beyin) ile <code>widget_modern.html</code> (iskelet) arasında bir köprü görevi görür. Core'dan gelen verileri alır ve bu verileri kullanarak HTML elementlerini günceller ve animasyonları yönetir. Kısacası, modern widget'ın "canlı" olmasını sağlayan koddur.</p>

                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Fonksiyon Analizi</h3>
                    <ul class="list-disc list-inside space-y-3">
                        <li><code>initWidget()</code>: Sayfa yüklendiğinde çalışır. HTML'den <code>data-*</code> attribute'larını okur ve <code>WidgetCore</code>'u bu ayarlarla başlatır.</li>
                        <li><code>handleSongChange(newData, oldData)</code>: <code>WidgetCore</code> tarafından bir şarkı değişikliği olduğunda çağrılır. Animasyonun meşgul olup olmadığını kontrol eder ve duruma göre <code>playIntroAnimation</code>, <code>playOutroAnimation</code> veya <code>playTransition</code> fonksiyonlarından uygun olanı çağırır.</li>
                        <li><code>updateElementSet(setKey, data)</code>: Belirtilen sete (A veya B) ait tüm HTML elementlerini (şarkı adı, sanatçı, albüm kapağı vb.) gelen yeni verilerle günceller.</li>
                        <li><code>playTransition(activeKey, passiveKey, data)</code>: Animasyon mantığının kalbidir. Aktif seti (eski şarkı) ekran dışına çıkarırken, yeni veriyle doldurulmuş pasif seti (yeni şarkı) ekrana getirir. Z-index ayarlarıyla elementlerin doğru katmanda kalmasını sağlar.</li>
                        <li><code>_applyAnimations(...)</code>: HTML'deki <code>data-*</code> animasyon attribute'larını okuyup ilgili elementlere CSS animasyonlarını uygulayan çok önemli bir yardımcı fonksiyondur.</li>
                    </ul>

                    <h3 class="text-xl font-semibold text-white mt-6 mb-3">Değerlendirme</h3>
                    <p class="pro"><strong>Olumlu Yönler:</strong></p>
                    <ul class="list-disc list-inside ml-4 space-y-2 text-gray-300">
                        <li><span class="pro">Sorumlulukların Net Ayrımı:</span> Sadece arayüz mantığı ve animasyon orkestrasyonu ile ilgilenir. Veri çekme gibi işleri Core'a bırakır.</li>
                        <li><span class="pro">Animasyon Yönetimi:</span> A/B setleri ve <code>isAnimating</code> bayrağı ile animasyonları temiz bir şekilde yönetir, çakışmaları önler.</li>
                        <li><span class="pro">Esneklik:</span> Core'dan gelen olaylara (event/callback) tepki vererek çalışması, sistemi esnek kılar.</li>
                    </ul>
                     <p class="con mt-4"><strong>Geliştirme Önerileri:</strong></p>
                    <ul class="list-disc list-inside ml-4 space-y-2 text-gray-300">
                        <li><span class="con">Animasyon Kilidi:</span> <code>isAnimating</code> bayrağı basit bir kilitleme mekanizmasıdır. Çok hızlı art arda gelen güncellemelerde (pratikte pek olası olmasa da), bir sonraki animasyonun atlanmasına neden olabilir. Daha karmaşık senaryolar için bir "aksiyon kuyruğu" (action queue) düşünülebilirdi.</li>
                    </ul>
                </div>

                <!-- CSS Dosyaları -->
                <div id="core-css" class="tab-content">
                    <h2 class="text-3xl font-bold text-white mb-4"><code>spotify_widget_core.css</code></h2>
                    <p>Tüm widget'lar tarafından paylaşılabilecek temel ve ortak stilleri içerir. Sayfa sıfırlama (reset), widget konteyneri için temel kurallar, ilerleme çubuğu, zaman göstergesi ve hata mesajı gibi ortak bileşenlerin stillerini tanımlar. Ayrıca animasyon sisteminin bel kemiği olan <code>.passive</code> sınıfını içerir.</p>
                </div>

                <div id="modern-css" class="tab-content">
                    <h2 class="text-3xl font-bold text-white mb-4"><code>widget_modern.css</code></h2>
                    <p>Bu dosya, modern widget'ın görsel kimliğini tanımlar. <code>core.css</code>'deki temel stilleri alır ve üzerine modern widget'a özgü boyutlandırma, renkler, fontlar, gölgeler ve yerleşimleri (layout) ekler. Arka plandaki bulanık albüm kapağı, gradyan geçişleri ve metin stilleri gibi estetik detaylar burada tanımlanır. Yapı, yorum satırları ile çok iyi organize edilmiştir.</p>
                </div>
                
                <div id="anim-css" class="tab-content">
                    <h2 class="text-3xl font-bold text-white mb-4"><code>widget_modern_animations.css</code></h2>
                     <p>Sadece CSS <code>@keyframes</code> animasyon tanımlarını içerir. <code>slide-in-right</code>, <code>fade-out</code> gibi animasyonların nasıl davranacağını belirtir. Animasyon tanımlarını diğer stillerden ayrı bir dosyada tutmak, kod organizasyonu açısından mükemmel bir pratiktir.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Deactivate all
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));

                    // Activate clicked
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.target).classList.add('active');
                });
            });
        });
    </script>
</body>
</html>
