<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style>
        /* Base Widget Styles */
        :root {
            /* Tema değişkenleri - JavaScript tarafından güncellenecek */
            --bg-color: {{ '#121212' if config.theme == 'dark' else '#ffffff' }};
            --text-color: {{ '#ffffff' if config.theme == 'dark' else '#121212' }};
            --secondary-text-color: {{ '#b3b3b3' if config.theme == 'dark' else '#666666' }};
            --accent-color: #1DB954; /* Spotify yeşili */
            --border-color: {{ '#333333' if config.theme == 'dark' else '#e0e0e0' }};
            
            /* Font boyutu değişkenleri */
            --font-size-base: {{ '14px' if config.font_size == 'small' else '16px' if config.font_size == 'medium' else '18px' }};
            --font-size-title: {{ '16px' if config.font_size == 'small' else '18px' if config.font_size == 'medium' else '20px' }};
            --font-size-artist: {{ '13px' if config.font_size == 'small' else '15px' if config.font_size == 'medium' else '17px' }};
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: var(--font-size-base);
            line-height: 1.5;
            padding: 16px;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .widget-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .widget-header {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
        }
        
        .widget-title {
            font-weight: 600;
            font-size: var(--font-size-title);
        }
        
        .widget-logo {
            height: 24px;
            width: auto;
        }
        
        .widget-content {
            padding: 16px;
        }
        
        .playlist-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .playlist-cover {
            width: 100px;
            height: 100px;
            border-radius: 4px;
            margin-right: 16px;
            background-color: var(--border-color);
            flex-shrink: 0;
            display: {{ 'block' if config.show_album_art else 'none' }};
        }
        
        .playlist-info {
            flex-grow: 1;
        }
        
        .playlist-name {
            font-weight: 600;
            font-size: var(--font-size-title);
            margin-bottom: 4px;
        }
        
        .playlist-owner {
            font-size: var(--font-size-artist);
            color: var(--secondary-text-color);
        }
        
        .playlist-description {
            margin-top: 8px;
            font-size: var(--font-size-artist);
            color: var(--secondary-text-color);
        }
        
        .playlist-tracks {
            list-style: none;
            margin-top: 16px;
        }
        
        .playlist-track {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .playlist-track:last-child {
            border-bottom: none;
        }
        
        .track-number {
            min-width: 24px;
            text-align: center;
            color: var(--secondary-text-color);
            font-size: 14px;
        }
        
        .track-info {
            flex-grow: 1;
            overflow: hidden;
            padding: 0 12px;
        }
        
        .track-name {
            font-weight: 600;
            font-size: var(--font-size-title);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .artist-name {
            font-size: var(--font-size-artist);
            color: var(--secondary-text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .track-duration {
            color: var(--secondary-text-color);
            font-size: 14px;
            min-width: 40px;
            text-align: right;
        }
        
        .widget-footer {
            padding: 8px 16px;
            font-size: 12px;
            color: var(--secondary-text-color);
            text-align: center;
            border-top: 1px solid var(--border-color);
        }
        
        .widget-footer a {
            color: var(--accent-color);
            text-decoration: none;
        }
        
        .widget-footer a:hover {
            text-decoration: underline;
        }
        
        /* Responsive ayarlamalar */
        @media (max-width: 500px) {
            .playlist-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .playlist-cover {
                margin-bottom: 12px;
                margin-right: 0;
            }
            
            .track-duration {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="widget-container">
        <div class="widget-header">
            <div class="widget-title">Çalma Listesi</div>
            <img src="{{ url_for('static', filename='img/spotify-logo.svg') }}" alt="Spotify" class="widget-logo">
        </div>
        
        <div class="widget-content">
            <div class="playlist-header">
                <img id="playlist-cover" class="playlist-cover" src="" alt="Playlist Cover">
                <div class="playlist-info">
                    <div id="playlist-name" class="playlist-name">Yükleniyor...</div>
                    <div id="playlist-owner" class="playlist-owner">-</div>
                    <div id="playlist-description" class="playlist-description"></div>
                </div>
            </div>
            
            <ul id="playlist-tracks" class="playlist-tracks">
                <li class="playlist-track">
                    <div class="track-number">1</div>
                    <div class="track-info">
                        <div class="track-name">Yükleniyor...</div>
                        <div class="artist-name">-</div>
                    </div>
                    <div class="track-duration">-</div>
                </li>
            </ul>
        </div>
        
        <div class="widget-footer">
            Powered by <a href="https://spotify.com" target="_blank">Spotify</a>
        </div>
    </div>

    <script>
        // Widget yapılandırması
        const config = {
            type: '{{ config.type }}',
            theme: '{{ config.theme }}',
            showAlbumArt: {{ 'true' if config.show_album_art else 'false' }},
            fontSize: '{{ config.font_size }}',
            dataEndpoint: '{{ config.dataEndpoint }}',
            widgetToken: '{{ config.widgetToken }}'
        };
        
        // DOM elementleri
        const playlistCover = document.getElementById('playlist-cover');
        const playlistName = document.getElementById('playlist-name');
        const playlistOwner = document.getElementById('playlist-owner');
        const playlistDescription = document.getElementById('playlist-description');
        const playlistTracks = document.getElementById('playlist-tracks');
        
        // Widget verilerini yükle
        async function loadWidgetData() {
            try {
                const response = await fetch(config.dataEndpoint);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                updateWidget(data);
            } catch (error) {
                console.error('Widget verisi yüklenirken hata oluştu:', error);
                playlistName.textContent = 'Veri yüklenemedi';
                playlistOwner.textContent = 'Lütfen daha sonra tekrar deneyin';
                playlistTracks.innerHTML = `
                    <li class="playlist-track">
                        <div class="track-number">-</div>
                        <div class="track-info">
                            <div class="track-name">Veri yüklenemedi</div>
                            <div class="artist-name">-</div>
                        </div>
                        <div class="track-duration">-</div>
                    </li>
                `;
            }
        }
        
        // Widget'ı güncelle
        function updateWidget(data) {
            if (data.playlist) {
                playlistName.textContent = data.playlist.name || 'İsimsiz Çalma Listesi';
                playlistOwner.textContent = data.playlist.owner ? `${data.playlist.owner}` : '-';
                playlistDescription.textContent = data.playlist.description || '';
                
                if (config.showAlbumArt && data.playlist.image_url) {
                    playlistCover.src = data.playlist.image_url;
                    playlistCover.alt = `${data.playlist.name} cover`;
                }
                
                if (data.playlist.tracks && data.playlist.tracks.length > 0) {
                    playlistTracks.innerHTML = '';
                    data.playlist.tracks.forEach((track, index) => {
                        const li = document.createElement('li');
                        li.className = 'playlist-track';
                        
                        li.innerHTML = `
                            <div class="track-number">${index + 1}</div>
                            <div class="track-info">
                                <div class="track-name">${track.track_name}</div>
                                <div class="artist-name">${track.artist_name}</div>
                            </div>
                            <div class="track-duration">${formatDuration(track.duration_ms)}</div>
                        `;
                        
                        playlistTracks.appendChild(li);
                    });
                } else {
                    playlistTracks.innerHTML = `
                        <li class="playlist-track">
                            <div class="track-number">-</div>
                            <div class="track-info">
                                <div class="track-name">Bu çalma listesinde parça bulunamadı</div>
                                <div class="artist-name">-</div>
                            </div>
                            <div class="track-duration">-</div>
                        </li>
                    `;
                }
            } else {
                playlistName.textContent = 'Çalma listesi bulunamadı';
                playlistOwner.textContent = '-';
                playlistDescription.textContent = '';
                playlistTracks.innerHTML = `
                    <li class="playlist-track">
                        <div class="track-number">-</div>
                        <div class="track-info">
                            <div class="track-name">Veri bulunamadı</div>
                            <div class="artist-name">-</div>
                        </div>
                        <div class="track-duration">-</div>
                    </li>
                `;
            }
        }
        
        // Süre formatla (ms -> mm:ss)
        function formatDuration(ms) {
            if (!ms) return '-';
            
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Sayfa yüklendiğinde widget verilerini yükle
        document.addEventListener('DOMContentLoaded', function() {
            loadWidgetData();
            
            // Periyodik olarak widget verilerini güncelle (saatte bir)
            setInterval(loadWidgetData, 60 * 60 * 1000);
        });
    </script>
</body>
</html>
